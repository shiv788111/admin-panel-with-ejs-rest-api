<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/stylesheets/form.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

<div class="form-container">
  <h1><%= title %></h1>

  <form id="userForm" action="<%= user && user.id ? '/users/update/' + user.id : '/users/add' %>" method="POST">

    <label>Name</label>
    <input type="text" name="name" value="<%= user ? user.name : '' %>" required>

    <label>Email</label>
    <input type="email" name="email" value="<%= user ? user.email : '' %>" required>

    <label>Location</label>
    <input type="text" name="location" value="<%= user ? user.location : '' %>" required>

    <button type="submit"><%= user && user.id ? 'Update' : 'Add' %></button>
    
  </form>
    <a href="/" class="btn">Back to Home</a>
</div>

<script>
document.getElementById("userForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const data = {
    name: e.target.name.value,
    email: e.target.email.value,
    location: e.target.location.value
  };

  const url = e.target.action;

  const res = await fetch("http://localhost:5000/users/add", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  const result = await res.json();

  if (res.ok) {
    Swal.fire({
      icon: "success",
      title: "Success!",
      text: result.message
    }).then(() => window.location.href = "/users");
  } else {
    Swal.fire({
      icon: "error",
      title: "Error",
      text: result.message
    });
  }
});
</script>
</body>
</html>
